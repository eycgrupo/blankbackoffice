<?xml version="1.0" encoding="UTF-8"?>
<domain-models xmlns="http://axelor.com/xml/ns/domain-models"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/domain-models https://axelor.com/xml/ns/domain-models/domain-models_6.1.xsd">

  <module name="base" package="com.eyc.base.db" />

  <entity name="Cliente" cacheable="false">
      <one-to-many name="pagos" ref="Pago" mappedBy="cliente" title="Pagos" />
      <string name="nombre"   title="Nombre"   />
      <string name="apellidos"  title="Apellidos"   />
      <string name="nombreCompleto" nameColumn="true" search="nombre,apellidos"  title="Nombre completo">
      <![CDATA[
            if (nombre == null && apellidos == null)
              return null;
            if (apellidos == null)
                    return  nombre;
            if (nombre == null)
                    return  apellidos;
            return  nombre + " " + apellidos;
    ]]></string>
      <string name="comentarios" large="true" title="Comentarios" />
      <boolean name="activo" title="es Activo?" default = "true" />
      <decimal name="saldo" title="Saldo actual"  precision="12" scale="2" 
            default="0.00"  />
      <decimal name="pagosConsolidados" title="Consolidados"  formula="true">
       <![CDATA[
        ( SELECT sum(c.monto) FROM base_pago c
           WHERE c.cliente = id  
             AND c.consolidado = true)
         ]]> 
      </decimal>
    
       <decimal name="pagosNoConsolidados" title="No consolidados"  formula="true">
       <![CDATA[
        ( SELECT sum(c.monto) FROM base_pago c
           WHERE c.cliente = id  
             AND c.consolidado = false)
         ]]> 
      </decimal>
  </entity>
 
</domain-models>